# СТРУКТУРИРОВАННЫЙ ПЛАН РЕШЕНИЯ
**Проблема**: Сайт не запускается на порту 3000, домен недоступен  
**RAM ограничение**: 2GB  
**SSH метод**: Method 6.1 только  

## ПЛАН РЕШЕНИЯ (пошагово)

### ФАЗА 1: ОЧИСТКА И ПОДГОТОВКА
1. **Остановить все процессы** - освободить RAM
   - Команда: `pm2 delete all && pkill -f node`
   - Ожидаемый результат: Все Node.js процессы остановлены
   - Статус: [ ]

2. **Проверить свободную RAM** - убедиться в достаточности ресурсов
   - Команда: `free -h`
   - Ожидаемый результат: >500MB свободной RAM
   - Статус: [ ]

3. **Очистить кеши npm** - устранить возможные конфликты
   - Команда: `npm cache clean --force`
   - Ожидаемый результат: Кеш очищен
   - Статус: [ ]

### ФАЗА 2: ПРОВЕРКА ПРОЕКТА
4. **Перейти в директорию проекта**
   - Команда: `cd /var/www/smilerentalphuket.com/site-smile-rental && pwd`
   - Ожидаемый результат: Подтверждение правильной директории
   - Статус: [ ]

5. **Проверить package.json**
   - Команда: `cat package.json | grep -A 5 scripts`
   - Ожидаемый результат: Видны скрипты dev, build, start
   - Статус: [ ]

6. **Проверить node_modules**
   - Команда: `ls -la node_modules | wc -l`
   - Ожидаемый результат: >100 директорий (зависимости установлены)
   - Статус: [ ]

### ФАЗА 3: УСТАНОВКА ЗАВИСИМОСТЕЙ (с учетом RAM)
7. **Установить зависимости с ограничением памяти**
   - Команда: `NODE_OPTIONS="--max-old-space-size=1024" npm install`
   - Ожидаемый результат: Успешная установка без ошибок памяти
   - Статус: [ ]

### ФАЗА 4: ЗАПУСК В DEVELOPMENT РЕЖИМЕ
8. **Запустить dev сервер напрямую (тест)**
   - Команда: `NODE_OPTIONS="--max-old-space-size=1024" npm run dev`
   - Ожидаемый результат: Сервер запущен на localhost:3000
   - Статус: [ ]

9. **Проверить порт 3000 изнутри**
   - Команда: `curl -I http://localhost:3000`
   - Ожидаемый результат: HTTP 200 OK
   - Статус: [ ]

### ФАЗА 5: PRODUCTION ЗАПУСК
10. **Собрать проект для production**
    - Команда: `NODE_OPTIONS="--max-old-space-size=1024" npm run build`
    - Ожидаемый результат: Успешная сборка .next директории
    - Статус: [ ]

11. **Запустить через PM2 с ограничением памяти**
    - Команда: `pm2 start npm --name "smile-rental" --node-args="--max-old-space-size=1024" -- start`
    - Ожидаемый результат: PM2 процесс запущен и работает
    - Статус: [ ]

12. **Проверить статус PM2**
    - Команда: `pm2 list && pm2 logs smile-rental --lines 10`
    - Ожидаемый результат: Процесс online, нет ошибок в логах
    - Статус: [ ]

### ФАЗА 6: НАСТРОЙКА NGINX
13. **Проверить конфигурацию Nginx**
    - Команда: `nginx -t && systemctl reload nginx`
    - Ожидаемый результат: Конфигурация валидна, Nginx перезагружен
    - Статус: [ ]

### ФАЗА 7: ТЕСТИРОВАНИЕ
14. **Тест домена**
    - Команда: `curl -I http://smilerentalphuket.com`
    - Ожидаемый результат: HTTP 200 OK
    - Статус: [ ]

15. **Тест HTTPS (если настроен)**
    - Команда: `curl -I https://smilerentalphuket.com`
    - Ожидаемый результат: HTTP 200 OK или редирект
    - Статус: [ ]

## АЛЬТЕРНАТИВНЫЙ ПЛАН: GITHUB REDEPLOY
Если основной план не работает:

16. **Клонировать свежую версию из GitHub**
    - Команда: `cd /var/www/smilerentalphuket.com && rm -rf site-smile-rental && git clone [repo-url] site-smile-rental`
    - Ожидаемый результат: Свежие файлы проекта
    - Статус: [ ]

17. **Повторить установку и запуск**
    - Повторить шаги 4-15
    - Статус: [ ]

## КРИТЕРИИ УСПЕХА
- ✅ PM2 процесс online
- ✅ Порт 3000 отвечает
- ✅ Домен доступен
- ✅ Сайт загружается в браузере
- ✅ Скриншоты созданы
